<!DOCTYPE html>
<html lang="eng">
<head>
    <meta charset="utf-8" />
    <title>Payment</title>
</head>
<body>
<%- include('partials/navbar.ejs') %>
<p>Please enter your card information.</p>

<form id="payment-form"  action=/payment/create method="post">
    <label for="price">Price:</label>
    <input type="number" id="price" name="price" min=1.00 step="0.25" placeholder="0.00" required> â‚¬
    <br>
    <label for="card_number">Card Number:</label>
    <input type="text" id="card_number" name="card_number" placeholder="XXXX XXXX XXXX XXXX" required>
    <br>
    <label for="cvv">CVV:</label>
    <input type="text" id="cvv" name="cvv" placeholder="XXX" required>
    <br>
    <label for="owner">Owner:</label>
    <input type="text" id="owner" name="owner" placeholder="Name" required>
    <br>
    <label for="month_exp">Expiration Date:</label>
    <label>
        <select name="month_exp">
            <option value="jan">January</option>
            <option value="feb">February</option>
            <option value="mar">March</option>
            <option value="apr">April</option>
            <option value="may">May</option>
            <option value="jun">June</option>
            <option value="jul">July</option>
            <option value="aug">August</option>
            <option value="sep">September</option>
            <option value="oct">October</option>
            <option value="nov">November</option>
            <option value="dec">December</option>
        </select>
    </label>

    <label>
        <select name="year_exp">
            <option value="y22">2022</option>
            <option value="y23">2023</option>
            <option value="y24">2024</option>
            <option value="y25">2025</option>
            <option value="y26">2026</option>
            <option value="y27">2027</option>
            <option value="y28">2028</option>
            <option value="y29">2029</option>
            <option value="y30">2030</option>
        </select>
    </label>
    <br>
    <input type="submit" id="submit">
</form>

<script>

  const response = fetch("/profile", {
    method: 'GET',
    headers: { "Authorization": "Bearer " + sessionStorage.getItem("team_galaxy_access_token") }
  }).then(async response => {
    if(!response.ok){
      location.href = "/";
    }
    await response.json();
  })
  const paymentButton = document.getElementById("submit");
  paymentButton.addEventListener("click", async (e) => {
    e.preventDefault();
    const response = await fetch("/payment/create", {
      method: 'POST',
      body: JSON.stringify({
        "price": parseInt(document.getElementById('payment-form').price.value),
        "card_number": document.getElementById('payment-form').card_number.value,
        "cvv": document.getElementById('payment-form').cvv.value,
        "owner": document.getElementById('payment-form').owner.value,
        "month_exp": document.getElementById('payment-form').month_exp.value,
        "year_exp": document.getElementById('payment-form').year_exp.value
      }),
      headers: { "Content-Type": "application/json" }
    }).catch(err => {  });
    if(response.ok){
      alert("Transaction Completed Successfully");
      location.href = "/payment/list";
    }else{
      alert("Transaction Failed");
    }
  });
</script>

</body>
</html>